From 73c3e7cfcba1320708cc360edce2465c711b7910 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Kamil=20Trzci=C5=84ski?= <ayufan@ayufan.eu>
Date: Wed, 21 Oct 2020 09:54:57 +0200
Subject: [PATCH] ayufan: dts: rockpro64: use backported fusb302 from 4.4

---
 .../boot/dts/rockchip/rk3399-rockpro64.dtsi   | 110 +-----------------
 1 file changed, 3 insertions(+), 107 deletions(-)

diff --git a/arch/arm64/boot/dts/rockchip/rk3399-rockpro64.dtsi b/arch/arm64/boot/dts/rockchip/rk3399-rockpro64.dtsi
index 874af7d3b6339..cf8e5961bcf7c 100644
--- a/arch/arm64/boot/dts/rockchip/rk3399-rockpro64.dtsi
+++ b/arch/arm64/boot/dts/rockchip/rk3399-rockpro64.dtsi
@@ -153,22 +153,6 @@
 		vin-supply = <&vcc5v0_usb>;
 	};
 
-	vcc5v0_typec: vcc5v0-typec-regulator {
-		compatible = "regulator-fixed";
-		enable-active-high;
-		gpio = <&gpio1 RK_PA3 GPIO_ACTIVE_HIGH>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&vcc5v0_typec_en>;
-		regulator-min-microvolt = <5000000>;
-		regulator-max-microvolt = <5000000>;
-		regulator-name = "vcc5v0_typec";
-		vin-supply = <&vcc5v0_usb>;
-
-		regulator-state-mem {
-			regulator-off-in-suspend;
-		};
-	};
-
 	vcc5v0_sys: vcc5v0-sys {
 		compatible = "regulator-fixed";
 		regulator-name = "vcc5v0_sys";
@@ -512,79 +496,13 @@
 	status = "okay";
 
 	fusb0: typec-portc@22 {
-		compatible = "fcs,fusb302";
+		compatible = "fairchild,fusb302";
 		reg = <0x22>;
-		fcs,int_n = <&gpio1 RK_PA2 GPIO_ACTIVE_HIGH>;
 		pinctrl-names = "default";
 		pinctrl-0 = <&fusb0_int>;
-		vbus-supply = <&vcc5v0_typec>;
+		vbus-5v-gpios = <&gpio1 RK_PA3 GPIO_ACTIVE_HIGH>;
+		int-n-gpios = <&gpio1 RK_PA2 GPIO_ACTIVE_HIGH>;
 		status = "okay";
-
-		connector {
-			compatible = "usb-c-connector";
-			data-role = "host";
-			label = "USB-C";
-			op-sink-microwatt = <1000000>;
-			power-role = "dual";
-			sink-pdos =
-				<PDO_FIXED(5000, 2500, PDO_FIXED_USB_COMM)>;
-			source-pdos =
-				<PDO_FIXED(5000, 1400, PDO_FIXED_USB_COMM)>;
-			try-power-role = "sink";
-
-			// [  128.617910] typec_displayport port0-partner.0:
-			// No compatible pin configuration found:0000 -> 000c, 001c <- 0000
-			// No compatible pin configuration found:0000 -> 000c, 000c <- 0000
-			// No compatible pin configuration found:0000 -> 000c, 0000 <- 0000
-			// No compatible pin configuration found:0000 -> 000c, 0000 <- 0000
-			// No compatible pin configuration found:000c -> 0000, 0000 <- 000c
-
-			// root@rockpro64:/sys/devices/platform/ff3d0000.i2c/i2c-4/4-0022/typec/port0/port0-partner/port0-partner.0# cat svid 
-			// ff01
-			// root@rockpro64:/sys/devices/platform/ff3d0000.i2c/i2c-4/4-0022/typec/port0/port0-partner/port0-partner.0# cat vdo
-			// 0x00000c05
-			// root@rockpro64:/sys/devices/platform/ff3d0000.i2c/i2c-4/4-0022/typec/port0/port0-partner/port0-partner.0# cat mode
-			// 1
-			// root@rockpro64:/sys/devices/platform/ff3d0000.i2c/i2c-4/4-0022/typec/port0/port0-partner/port0-partner.0# cat active 
-			// yes
-
-			extcon-cables = <1 2 5 6 9 10 12 44>;
-			typec-altmodes = <
-				0xff01 1 0x001c0c00 1
-			>;
-
-			ports {
-				#address-cells = <1>;
-				#size-cells = <0>;
-
-				port@0 {
-					reg = <0>;
-
-					usbc_hs: endpoint {
-						remote-endpoint =
-							<&u2phy0_typec_hs>;
-					};
-				};
-
-				port@1 {
-					reg = <1>;
-
-					usbc_ss: endpoint {
-						remote-endpoint =
-							<&tcphy0_typec_ss>;
-					};
-				};
-
-				port@2 {
-					reg = <2>;
-
-					usbc_dp: endpoint {
-						remote-endpoint =
-							<&tcphy0_typec_dp>;
-					};
-				};
-			};
-		};
 	};
 };
 
@@ -715,12 +633,6 @@
 		};
 	};
 
-	usb-typec {
-		vcc5v0_typec_en: vcc5v0_typec_en {
-			rockchip,pins = <1 RK_PA3 RK_FUNC_GPIO &pcfg_pull_up>;
-		};
-	};
-
 	usb2 {
 		vcc5v0_host_en: vcc5v0-host-en {
 			rockchip,pins = <4 RK_PD2 RK_FUNC_GPIO &pcfg_pull_none>;
@@ -816,19 +728,9 @@
 };
 
 &tcphy0_dp {
-	port {
-		tcphy0_typec_dp: endpoint {
-			remote-endpoint = <&usbc_dp>;
-		};
-	};
 };
 
 &tcphy0_usb3 {
-	port {
-		tcphy0_typec_ss: endpoint {
-			remote-endpoint = <&usbc_ss>;
-		};
-	};
 };
 
 &tcphy1 {
@@ -854,12 +756,6 @@
 		phy-supply = <&vcc5v0_host>;
 		status = "okay";
 	};
-
-	port {
-		u2phy0_typec_hs: endpoint {
-			remote-endpoint = <&usbc_hs>;
-		};
-	};
 };
 
 &u2phy1 {
